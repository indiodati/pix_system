<h1 class="text-3xl font-bold mb-6">Criar PIX</h1>

<%= render "form", pix_transaction: @pix_transaction %>

<!-- Máscara de dinheiro em JS -->
<script>
  (function() {
    function attachMoneyMask() {
      var inputs = document.querySelectorAll('.money-input');
      if (!inputs.length) return;

      inputs.forEach(function(input) {
        input.addEventListener('input', function(e) {
          var value = e.target.value.replace(/\D/g, ''); // só dígitos
          if (value === '') {
            e.target.value = '';
            return;
          }

          // trata como centavos
          var cents = parseInt(value, 10);
          var reais = cents / 100;

          e.target.value = reais.toLocaleString('pt-BR', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
          });
        });

        // Se já tiver valor (ex: quando volta com erro), aplica formatação
        if (input.value && input.value.match(/\d/)) {
          var evt = new Event('input', { bubbles: true });
          input.dispatchEvent(evt);
        }
      });
    }

    document.addEventListener('DOMContentLoaded', attachMoneyMask);
    document.addEventListener('turbo:load', attachMoneyMask); // para Rails 7 com Turbo
  })();
</script>
